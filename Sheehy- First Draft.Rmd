---
title: "Social Media"
author: "Bridget Sheehy"
date: "2025-11-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(foreign)
  read.dct <- function(dct, labels.included = "yes") {
      temp <- readLines(dct)
      temp <- temp[grepl("_column", temp)]
      switch(labels.included,
             yes = {
                 pattern <- "_column\\(([0-9]+)\\)\\s+([a-z0-9]+)\\s+(.*)\\s+%([0-9]+)[a-z]\\s+(.*)"
                 classes <- c("numeric", "character", "character", "numeric", "character")
                 N <- 5
                 NAMES <- c("StartPos", "Str", "ColName", "ColWidth", "ColLabel")
             },
             no = {
                 pattern <- "_column\\(([0-9]+)\\)\\s+([a-z0-9]+)\\s+(.*)\\s+%([0-9]+).*"
                 classes <- c("numeric", "character", "character", "numeric")
                 N <- 4
                 NAMES <- c("StartPos", "Str", "ColName", "ColWidth")
             })
      temp_metadata <- setNames(lapply(1:N, function(x) {
          out <- gsub(pattern, paste("\\", x, sep = ""), temp)
          out <- gsub("^\\s+|\\s+$", "", out)
          out <- gsub('\"', "", out, fixed = TRUE)
          class(out) <- classes[x] ; out }), NAMES)
      temp_metadata[["ColName"]] <- make.names(gsub("\\s", "", temp_metadata[["ColName"]]))
      temp_metadata
  }

  read.dat <- function(dat, metadata_var, labels.included = "yes") {
      read.table(dat, col.names = metadata_var[["ColName"]])
  }


GSS_metadata <- read.dct("GSS.dct")
GSS_ascii <- read.dat("GSS.dat", GSS_metadata)
attr(GSS_ascii, "col.label") <- GSS_metadata[["ColLabel"]]
GSS <- GSS_ascii
```


```{r}
saveRDS(GSS, file = "GSS.rds")
GSS <- readRDS("GSS.rds")
```


```{r}
library(dplyr)
library(purrr)
library(broom)
#creating na's from -1--...
GSS <- GSS %>%
  mutate(across(everything(), ~ ifelse(.x < 0, NA, .x)))
#just 2016 data
GSS <- GSS %>% 
  filter(YEAR == 2016)
#lowercase column names
names(GSS) <- tolower(names(GSS))
```


```{r}
sm_var <- c("snapchat", "instagrm", "pinterst", 
                       "facebook", "twitter", "linkedin")
```

```{r}
#head(GSS)
```


```{r}
scan_models <- function(sm_var) {
  
  outcomes <- setdiff(names(GSS), sm_var)
  
  map_df(outcomes, function(outcome) {
    
    #building formula
    f <- as.formula(paste(outcome, "~", sm_var))
    
    #get rows with both columns non-missing
    df_sub <- GSS %>%
      select(all_of(c(outcome, sm_var))) %>%
      filter(!is.na(.data[[outcome]]), !is.na(.data[[sm_var]]))
    
    #skip if not enough data
    if (nrow(df_sub) < 20) {
      return(tibble(
        outcome = outcome,
        sm_var = sm_var,
        n = nrow(df_sub),
        estimate = NA,
        p.value = NA,
        signif = FALSE
      ))
    }
    
    #run model
    m <- tryCatch(lm(f, data = df_sub), error = function(e) NULL)
    
    if (is.null(m)) return(NULL)
    
    #extract coefficient row for the social media variable
    coef_row <- tidy(m) %>% filter(term == sm_var)
    
    tibble(
      outcome = outcome,
      sm_var = sm_var,
      n = nrow(df_sub),
      estimate = coef_row$estimate,
      p.value = coef_row$p.value,
      signif = coef_row$p.value < 0.05
    )
    
  })
}

#Run the scan for all SM vars
scan_results <- map_df(sm_var, scan_models)

```

```{r}
#scan_results %>% filter(signif == TRUE)
#write.csv(scan_results, "scan_results.csv", row.names = FALSE)
```


```{r}
#Spiritual identity (sprtprsn) ~ snapchat + controls
GSS_clean <- GSS %>%
  mutate(across(everything(), ~ ifelse(.x < 0, NA, .x)))

model_sprtprsn <- lm(sprtprsn ~ snapchat + dwelown + intuse,
                     data = GSS_clean, na.action = na.omit)
summary(model_sprtprsn)
```
Colinearity
Snapchat is statistically signifcant
low model-fit (r squared)

```{r}
#Optimism (lotr6) ~ Snapchat + Homeownership
model_opt <- lm(lotr6 ~ snapchat + dwelown,
                data = GSS_clean,
                na.action = na.omit)

summary(model_opt)


#Work Stress (stress) ~ Snapchat + Homeownership
model_stress <- lm(stress ~ snapchat + dwelown,
                   data = GSS_clean,
                   na.action = na.omit)

summary(model_stress)

#Job Satisfaction (jobsat) ~ Snapchat + Homeownership
model_jobsat <- lm(jobsat ~ snapchat + dwelown,
                   data = GSS_clean,
                   na.action = na.omit)

summary(model_jobsat)

#Hope / Future Orientation (hope4) ~ Snapchat + Homeownership
model_hope <- lm(hope4 ~ snapchat + dwelown,
                 data = GSS_clean,
                 na.action = na.omit)

summary(model_hope)
```

```{r}
#Actual vs. Predicted plots
par(mfrow = c(3, 2))
#sprtprsn
plot(fitted(model_sprtprsn),
     model_sprtprsn$model$sprtprsn,
     xlab = "Predicted (sprtprsn)",
     ylab = "Actual (sprtprsn)",
     main = "Actual vs Predicted: sprtprsn",
     pch = 19)
abline(0, 1, col = "red", lwd = 2)

#lotr6
plot(fitted(model_opt),
     model_opt$model$lotr6,
     xlab = "Predicted (lotr6)",
     ylab = "Actual (lotr6)",
     main = "Actual vs Predicted: lotr6",
     pch = 19)
abline(0, 1, col = "red", lwd = 2)

#stress
plot(fitted(model_stress),
     model_stress$model$stress,
     xlab = "Predicted (stress)",
     ylab = "Actual (stress)",
     main = "Actual vs Predicted: stress",
     pch = 19)
abline(0, 1, col = "red", lwd = 2)

#jobsat
plot(fitted(model_jobsat),
     model_jobsat$model$jobsat,
     xlab = "Predicted (jobsat)",
     ylab = "Actual (jobsat)",
     main = "Actual vs Predicted: jobsat",
     pch = 19)
abline(0, 1, col = "red", lwd = 2)

#hope4
plot(fitted(model_hope),
     model_hope$model$hope4,
     xlab = "Predicted (hope4)",
     ylab = "Actual (hope4)",
     main = "Actual vs Predicted: hope4",
     pch = 19)
abline(0, 1, col = "red", lwd = 2)

par(mfrow = c(1,1))

```


```{r}
#Predicted vs Residual plots 
par(mfrow = c(3, 2))  

# sprtprsn
plot(fitted(model_sprtprsn), resid(model_sprtprsn),
     xlab = "Predicted values (sprtprsn)",
     ylab = "Residuals",
     main = "Residuals vs Predicted: sprtprsn",
     pch = 19)
abline(h = 0, col = "red")

# lotr6
plot(fitted(model_opt), resid(model_opt),
     xlab = "Predicted values (lotr6)",
     ylab = "Residuals",
     main = "Residuals vs Predicted: lotr6",
     pch = 19)
abline(h = 0, col = "red")

# stress
plot(fitted(model_stress), resid(model_stress),
     xlab = "Predicted values (stress)",
     ylab = "Residuals",
     main = "Residuals vs Predicted: stress",
     pch = 19)
abline(h = 0, col = "red")

# jobsat
plot(fitted(model_jobsat), resid(model_jobsat),
     xlab = "Predicted values (jobsat)",
     ylab = "Residuals",
     main = "Residuals vs Predicted: jobsat",
     pch = 19)
abline(h = 0, col = "red")

# hope4
plot(fitted(model_hope), resid(model_hope),
     xlab = "Predicted values (hope4)",
     ylab = "Residuals",
     main = "Residuals vs Predicted: hope4",
     pch = 19)
abline(h = 0, col = "red")

#reset
par(mfrow = c(1,1))

```

